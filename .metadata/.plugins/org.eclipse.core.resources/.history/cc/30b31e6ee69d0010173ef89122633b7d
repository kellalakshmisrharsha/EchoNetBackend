package com.app;

import org.springframework.web.bind.annotation.*;
import org.springframework.web.server.ServerWebExchange;
import reactor.core.publisher.Mono;

import java.util.List;

@RestController
@RequestMapping("/users")
public class UserController {

    private final FriendService friendService;

    public UserController(FriendService friendService) {
        this.friendService = friendService;
    }

    @GetMapping("/friends")
    public Mono<List<User>> getFriends(ServerWebExchange exchange) {
        Long userId = (Long) exchange.getAttribute("userId");
        return Mono.just(friendService.getFriendsOfUser(userId));
    }

    @PostMapping("/friends/{friendId}")
    public Mono<Friend> addFriend(ServerWebExchange exchange, @PathVariable Long friendId) {
        Long userId = (Long) exchange.getAttribute("userId");
        return Mono.just(friendService.addFriend(userId, friendId));
    }

    @DeleteMapping("/friends/{friendId}")
    public Mono<Void> removeFriend(ServerWebExchange exchange, @PathVariable Long friendId) {
        Long userId = (Long) exchange.getAttribute("userId");
        friendService.removeFriend(userId, friendId);
        return Mono.empty();
    }
}
